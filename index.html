<!DOCTYPE html>
<html lang="zh-HK">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Â©öÁ¶Æ‰ªªÂãôÁÆ°ÁêÜÁ≥ªÁµ±</title>
    <style>
      :root {
        /* Primitive Color Tokens */
        --color-white: rgba(255, 255, 255, 1);
        --color-black: rgba(0, 0, 0, 1);
        --color-cream-50: rgba(252, 252, 249, 1);
        --color-cream-100: rgba(255, 255, 253, 1);
        --color-gray-200: rgba(245, 245, 245, 1);
        --color-gray-300: rgba(167, 169, 169, 1);
        --color-gray-400: rgba(119, 124, 124, 1);
        --color-slate-500: rgba(98, 108, 113, 1);
        --color-brown-600: rgba(94, 82, 64, 1);
        --color-charcoal-700: rgba(31, 33, 33, 1);
        --color-charcoal-800: rgba(38, 40, 40, 1);
        --color-slate-900: rgba(19, 52, 59, 1);
        --color-teal-300: rgba(50, 184, 198, 1);
        --color-teal-400: rgba(45, 166, 178, 1);
        --color-teal-500: rgba(33, 128, 141, 1);
        --color-teal-600: rgba(29, 116, 128, 1);
        --color-teal-700: rgba(26, 104, 115, 1);
        --color-teal-800: rgba(41, 150, 161, 1);
        --color-red-400: rgba(255, 84, 89, 1);
        --color-red-500: rgba(192, 21, 47, 1);
        --color-orange-400: rgba(230, 129, 97, 1);
        --color-orange-500: rgba(168, 75, 47, 1);

        --color-brown-600-rgb: 94, 82, 64;
        --color-teal-500-rgb: 33, 128, 141;
        --color-slate-900-rgb: 19, 52, 59;
        --color-slate-500-rgb: 98, 108, 113;
        --color-red-500-rgb: 192, 21, 47;
        --color-red-400-rgb: 255, 84, 89;
        --color-orange-500-rgb: 168, 75, 47;
        --color-orange-400-rgb: 230, 129, 97;

        --color-bg-1: rgba(59, 130, 246, 0.08);
        --color-bg-2: rgba(245, 158, 11, 0.08);
        --color-bg-3: rgba(34, 197, 94, 0.08);
        --color-bg-4: rgba(239, 68, 68, 0.08);
        --color-bg-5: rgba(147, 51, 234, 0.08);
        --color-bg-6: rgba(249, 115, 22, 0.08);
        --color-bg-7: rgba(236, 72, 153, 0.08);
        --color-bg-8: rgba(6, 182, 212, 0.08);

        --color-background: var(--color-cream-50);
        --color-surface: var(--color-cream-100);
        --color-text: var(--color-slate-900);
        --color-text-secondary: var(--color-slate-500);
        --color-primary: var(--color-teal-500);
        --color-primary-hover: var(--color-teal-600);
        --color-primary-active: var(--color-teal-700);
        --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
        --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
        --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
        --color-border: rgba(var(--color-brown-600-rgb), 0.2);
        --color-btn-primary-text: var(--color-cream-50);
        --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
        --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
        --color-error: var(--color-red-500);
        --color-success: var(--color-teal-500);
        --color-warning: var(--color-orange-500);
        --color-info: var(--color-slate-500);
        --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
        --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

        --focus-ring: 0 0 0 3px var(--color-focus-ring);
        --focus-outline: 2px solid var(--color-primary);
        --status-bg-opacity: 0.15;
        --status-border-opacity: 0.25;

        --color-success-rgb: 33, 128, 141;
        --color-error-rgb: 192, 21, 47;
        --color-warning-rgb: 168, 75, 47;
        --color-info-rgb: 98, 108, 113;

        --font-family-base: 'FKGroteskNeue', 'Geist', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        --font-size-xs: 11px;
        --font-size-sm: 12px;
        --font-size-base: 14px;
        --font-size-md: 14px;
        --font-size-lg: 16px;
        --font-size-xl: 18px;
        --font-size-2xl: 20px;
        --font-size-3xl: 24px;
        --font-size-4xl: 30px;
        --font-weight-normal: 400;
        --font-weight-medium: 500;
        --font-weight-semibold: 550;
        --font-weight-bold: 600;
        --line-height-tight: 1.2;
        --line-height-normal: 1.5;

        --space-4: 4px;
        --space-8: 8px;
        --space-12: 12px;
        --space-16: 16px;
        --space-20: 20px;
        --space-24: 24px;
        --space-32: 32px;

        --radius-sm: 6px;
        --radius-base: 8px;
        --radius-md: 10px;
        --radius-lg: 12px;
        --radius-full: 9999px;

        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);

        --duration-fast: 150ms;
        --duration-normal: 250ms;
        --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --color-gray-400-rgb: 119, 124, 124;
          --color-teal-300-rgb: 50, 184, 198;
          --color-gray-300-rgb: 167, 169, 169;
          --color-gray-200-rgb: 245, 245, 245;

          --color-bg-1: rgba(29, 78, 216, 0.15);
          --color-bg-2: rgba(180, 83, 9, 0.15);
          --color-bg-3: rgba(21, 128, 61, 0.15);
          --color-bg-4: rgba(185, 28, 28, 0.15);
          --color-bg-5: rgba(107, 33, 168, 0.15);
          --color-bg-6: rgba(194, 65, 12, 0.15);
          --color-bg-7: rgba(190, 24, 93, 0.15);
          --color-bg-8: rgba(8, 145, 178, 0.15);

          --color-background: var(--color-charcoal-700);
          --color-surface: var(--color-charcoal-800);
          --color-text: var(--color-gray-200);
          --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
          --color-primary: var(--color-teal-300);
          --color-primary-hover: var(--color-teal-400);
          --color-primary-active: var(--color-teal-800);
          --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
          --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
          --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
          --color-border: rgba(var(--color-gray-400-rgb), 0.3);
          --color-error: var(--color-red-400);
          --color-success: var(--color-teal-300);
          --color-warning: var(--color-orange-400);
          --color-info: var(--color-gray-300);
          --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
          --color-btn-primary-text: var(--color-slate-900);
          --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
          --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);

          --color-success-rgb: var(--color-teal-300-rgb);
          --color-error-rgb: var(--color-red-400-rgb);
          --color-warning-rgb: var(--color-orange-400-rgb);
          --color-info-rgb: var(--color-gray-300-rgb);
        }
      }

      @font-face {
        font-family: 'FKGroteskNeue';
        src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2') format('woff2');
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-family-base);
        background-color: var(--color-background);
        color: var(--color-text);
        line-height: var(--line-height-normal);
        -webkit-font-smoothing: antialiased;
      }

      .app-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: var(--space-24);
      }

      .app-header {
        margin-bottom: var(--space-32);
      }

      .app-title {
        font-size: var(--font-size-4xl);
        font-weight: var(--font-weight-bold);
        margin-bottom: var(--space-8);
        color: var(--color-text);
      }

      .app-subtitle {
        font-size: var(--font-size-lg);
        color: var(--color-text-secondary);
      }

      .controls-section {
        display: flex;
        gap: var(--space-16);
        margin-bottom: var(--space-24);
        flex-wrap: wrap;
        align-items: center;
      }

      .search-box {
        flex: 1;
        min-width: 250px;
        padding: var(--space-12) var(--space-16);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-base);
        background-color: var(--color-surface);
        color: var(--color-text);
        font-size: var(--font-size-base);
        font-family: var(--font-family-base);
      }

      .search-box:focus {
        outline: var(--focus-outline);
        border-color: var(--color-primary);
      }

      .view-tabs {
        display: flex;
        gap: var(--space-8);
        background-color: var(--color-secondary);
        padding: var(--space-4);
        border-radius: var(--radius-base);
      }

      .tab-button {
        padding: var(--space-8) var(--space-16);
        border: none;
        background: transparent;
        color: var(--color-text);
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: all var(--duration-fast) var(--ease-standard);
        font-family: var(--font-family-base);
      }

      .tab-button:hover {
        background-color: var(--color-secondary-hover);
      }

      .tab-button.active {
        background-color: var(--color-primary);
        color: var(--color-btn-primary-text);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--space-16);
        margin-bottom: var(--space-32);
      }

      .stat-card {
        background-color: var(--color-surface);
        padding: var(--space-20);
        border-radius: var(--radius-lg);
        border: 1px solid var(--color-card-border);
        box-shadow: var(--shadow-sm);
      }

      .stat-label {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
        margin-bottom: var(--space-8);
        font-weight: var(--font-weight-medium);
      }

      .stat-value {
        font-size: var(--font-size-3xl);
        font-weight: var(--font-weight-bold);
        color: var(--color-text);
      }

      .stat-card.completed .stat-value {
        color: var(--color-success);
      }

      .stat-card.in-progress .stat-value {
        color: var(--color-warning);
      }

      .stat-card.not-started .stat-value {
        color: var(--color-error);
      }

      .tasks-container {
        background-color: var(--color-surface);
        border-radius: var(--radius-lg);
        border: 1px solid var(--color-card-border);
        box-shadow: var(--shadow-md);
        overflow: hidden;
      }

      .group-section {
        border-bottom: 1px solid var(--color-card-border-inner);
      }

      .group-section:last-child {
        border-bottom: none;
      }

      .group-header {
        padding: var(--space-16) var(--space-20);
        background-color: var(--color-bg-1);
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-semibold);
        color: var(--color-text);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .group-count {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
        font-weight: var(--font-weight-normal);
      }

      .task-item {
        padding: var(--space-16) var(--space-20);
        border-bottom: 1px solid var(--color-card-border-inner);
        cursor: pointer;
        transition: background-color var(--duration-fast) var(--ease-standard);
        display: grid;
        grid-template-columns: 80px 1fr 180px 130px;
        gap: var(--space-16);
        align-items: start;
      }

      .task-item:last-child {
        border-bottom: none;
      }

      .task-item:hover {
        background-color: var(--color-secondary);
      }

      .task-item.overdue {
        border-left: 4px solid var(--color-error);
      }

      .task-item.upcoming {
        border-left: 4px solid var(--color-primary);
      }

      .task-item.completed {
        opacity: 0.7;
      }

      .task-time {
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-bold);
        color: var(--color-text);
        font-family: var(--font-family-base);
        align-self: center;
      }

      .task-content {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
      }

      .task-description {
        font-size: var(--font-size-base);
        color: var(--color-text);
        font-weight: var(--font-weight-medium);
      }

      .task-stage {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
      }

      .task-responsible {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
        align-self: center;
      }

      .task-status {
        display: inline-flex;
        align-items: center;
        padding: var(--space-8) var(--space-12);
        border-radius: var(--radius-full);
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
        justify-self: end;
        align-self: center;
      }

      .task-status.not-started {
        background-color: rgba(var(--color-error-rgb), var(--status-bg-opacity));
        color: var(--color-error);
        border: 1px solid rgba(var(--color-error-rgb), var(--status-border-opacity));
      }

      .task-status.in-progress {
        background-color: rgba(var(--color-warning-rgb), var(--status-bg-opacity));
        color: var(--color-warning);
        border: 1px solid rgba(var(--color-warning-rgb), var(--status-border-opacity));
      }

      .task-status.completed {
        background-color: rgba(var(--color-success-rgb), var(--status-bg-opacity));
        color: var(--color-success);
        border: 1px solid rgba(var(--color-success-rgb), var(--status-border-opacity));
      }

      .task-status.completed::before {
        content: '‚úì ';
        font-weight: var(--font-weight-bold);
      }

      .task-reminder {
        font-size: var(--font-size-sm);
        color: var(--color-primary);
        display: flex;
        align-items: center;
        gap: var(--space-4);
      }

      .reminder-badge {
        display: inline-flex;
        align-items: center;
        gap: var(--space-4);
        padding: var(--space-4) var(--space-8);
        background-color: rgba(var(--color-teal-500-rgb), 0.1);
        border: 1px solid rgba(var(--color-teal-500-rgb), 0.3);
        border-radius: var(--radius-sm);
        font-size: var(--font-size-xs);
        color: var(--color-primary);
        cursor: pointer;
      }

      .reminder-badge:hover {
        background-color: rgba(var(--color-teal-500-rgb), 0.15);
      }

      .reminder-icon {
        font-size: var(--font-size-base);
      }

      /* Modal Styles */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal-overlay.active {
        display: flex;
      }

      .modal {
        background-color: var(--color-surface);
        border-radius: var(--radius-lg);
        padding: var(--space-24);
        max-width: 400px;
        width: 90%;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      }

      .modal-header {
        font-size: var(--font-size-xl);
        font-weight: var(--font-weight-bold);
        margin-bottom: var(--space-16);
        color: var(--color-text);
      }

      .modal-task-info {
        margin-bottom: var(--space-20);
        padding: var(--space-12);
        background-color: var(--color-secondary);
        border-radius: var(--radius-base);
      }

      .modal-task-time {
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-bold);
        color: var(--color-text);
        margin-bottom: var(--space-4);
      }

      .modal-task-desc {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
      }

      .reminder-options {
        display: flex;
        flex-direction: column;
        gap: var(--space-12);
        margin-bottom: var(--space-20);
      }

      .reminder-option {
        display: flex;
        align-items: center;
        gap: var(--space-12);
        padding: var(--space-12);
        border: 2px solid var(--color-border);
        border-radius: var(--radius-base);
        cursor: pointer;
        transition: all var(--duration-fast) var(--ease-standard);
      }

      .reminder-option:hover {
        border-color: var(--color-primary);
        background-color: var(--color-secondary);
      }

      .reminder-option.selected {
        border-color: var(--color-primary);
        background-color: rgba(var(--color-teal-500-rgb), 0.1);
      }

      .reminder-option input[type='radio'] {
        width: 18px;
        height: 18px;
        cursor: pointer;
      }

      .reminder-option label {
        flex: 1;
        cursor: pointer;
        font-size: var(--font-size-base);
        color: var(--color-text);
      }

      .modal-actions {
        display: flex;
        gap: var(--space-12);
        justify-content: flex-end;
      }

      .modal-button {
        padding: var(--space-12) var(--space-20);
        border: none;
        border-radius: var(--radius-base);
        font-size: var(--font-size-base);
        font-weight: var(--font-weight-medium);
        cursor: pointer;
        transition: all var(--duration-fast) var(--ease-standard);
        font-family: var(--font-family-base);
      }

      .modal-button.primary {
        background-color: var(--color-primary);
        color: var(--color-btn-primary-text);
      }

      .modal-button.primary:hover {
        background-color: var(--color-primary-hover);
      }

      .modal-button.secondary {
        background-color: var(--color-secondary);
        color: var(--color-text);
      }

      .modal-button.secondary:hover {
        background-color: var(--color-secondary-hover);
      }

      .notification-permission {
        padding: var(--space-12);
        background-color: rgba(var(--color-warning-rgb), 0.1);
        border: 1px solid rgba(var(--color-warning-rgb), 0.3);
        border-radius: var(--radius-base);
        margin-bottom: var(--space-16);
        font-size: var(--font-size-sm);
        color: var(--color-text);
      }

      .no-results {
        padding: var(--space-32);
        text-align: center;
        color: var(--color-text-secondary);
        font-size: var(--font-size-lg);
      }

      @media (max-width: 768px) {
        .app-container {
          padding: var(--space-16);
        }

        .controls-section {
          flex-direction: column;
          align-items: stretch;
        }

        .view-tabs {
          flex-wrap: wrap;
        }

        .task-item {
          grid-template-columns: 1fr;
          gap: var(--space-8);
        }

        .task-time,
        .task-responsible,
        .task-status {
          align-self: start;
        }

        .task-status {
          justify-self: start;
        }

        .reminder-badge {
          margin-top: var(--space-8);
        }

        .stats-grid {
          grid-template-columns: 1fr 1fr;
        }

        .modal {
          max-width: 95%;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <header class="app-header">
        <h1 class="app-title">Â©öÁ¶Æ‰ªªÂãôÁÆ°ÁêÜÁ≥ªÁµ±</h1>
        <p class="app-subtitle">Sam &amp; Nam Â©öÁ¶ÆÊó•Á®ãËøΩËπ§</p>
      </header>

      <div class="controls-section">
        <input type="text" id="searchInput" class="search-box" placeholder="ÊêúÂ∞ã‰ªªÂãôÊàñË≤†Ë≤¨‰∫∫..." />

        <div class="view-tabs">
          <button class="tab-button active" data-view="timeline">ÊôÇÈñìËª∏Ë¶ñÂúñ</button>
          <button class="tab-button" data-view="stage">ÈöéÊÆµË¶ñÂúñ</button>
          <button class="tab-button" data-view="responsible">Ë≤†Ë≤¨‰∫∫Ë¶ñÂúñ</button>
          <button class="tab-button" data-view="stats">Áµ±Ë®àË¶ñÂúñ</button>
        </div>
      </div>

      <div id="statsSection" class="stats-grid" style="display: none">
        <div class="stat-card completed">
          <div class="stat-label">Â∑≤ÂÆåÊàê</div>
          <div class="stat-value" id="completedCount">0</div>
        </div>
        <div class="stat-card in-progress">
          <div class="stat-label">ÈÄ≤Ë°å‰∏≠</div>
          <div class="stat-value" id="inProgressCount">0</div>
        </div>
        <div class="stat-card not-started">
          <div class="stat-label">Êú™ÈñãÂßã</div>
          <div class="stat-value" id="notStartedCount">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Êï¥È´îÈÄ≤Â∫¶</div>
          <div class="stat-value" id="progressPercentage">0%</div>
        </div>
      </div>

      <div id="tasksContainer" class="tasks-container"></div>
    </div>

    <!-- Reminder Modal -->
    <div id="reminderModal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">Ë®≠ÁΩÆÊèêÈÜí</div>
        <div class="modal-task-info">
          <div class="modal-task-time" id="modalTaskTime"></div>
          <div class="modal-task-desc" id="modalTaskDesc"></div>
        </div>
        <div id="notificationWarning" class="notification-permission" style="display: none">‚ö†Ô∏è Ë´ãÂÖÅË®±ÁÄèË¶ΩÂô®ÈÄöÁü•Ê¨äÈôê‰ª•Êé•Êî∂ÊèêÈÜí</div>
        <div class="reminder-options">
          <div class="reminder-option" data-value="0">
            <input type="radio" name="reminder" id="reminder-none" value="0" />
            <label for="reminder-none">‰∏çË®≠ÊèêÈÜí</label>
          </div>
          <div class="reminder-option" data-value="5">
            <input type="radio" name="reminder" id="reminder-5" value="5" />
            <label for="reminder-5">‚è∞ ÊèêÂâç 5 ÂàÜÈêò</label>
          </div>
          <div class="reminder-option" data-value="10">
            <input type="radio" name="reminder" id="reminder-10" value="10" />
            <label for="reminder-10">‚è∞ ÊèêÂâç 10 ÂàÜÈêò</label>
          </div>
          <div class="reminder-option" data-value="15">
            <input type="radio" name="reminder" id="reminder-15" value="15" />
            <label for="reminder-15">‚è∞ ÊèêÂâç 15 ÂàÜÈêò</label>
          </div>
        </div>
        <div class="modal-actions">
          <button class="modal-button secondary" onclick="closeReminderModal()">ÂèñÊ∂à</button>
          <button class="modal-button primary" onclick="saveReminder()">Á¢∫Ë™ç</button>
        </div>
      </div>
    </div>

    <script>
      // Dark mode support
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
      }
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
        if (event.matches) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      });

      // Task data (default)
      const tasksData = [
        { time: '04:30', stage: 'Êñ∞Â®òÊ∫ñÂÇô', description: 'NamËµ∑Ë∫´Ê¢≥Ê¥óÂåñÂ¶ù', responsible: 'Êú±Áèä', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '05:30', stage: 'Êñ∞ÈÉéÊ∫ñÂÇô', description: 'SamËµ∑Ë∫´', responsible: 'Sam', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '05:35', stage: 'Êñ∞ÈÉéÊ∫ñÂÇô', description: 'Ê¢≥Ê¥óÊó©È§ê', responsible: 'Sam', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '06:00', stage: 'Êñ∞ÈÉéÊ∫ñÂÇô', description: 'SamÂ∫∑ÂüéÂá∫ÈñÄ', responsible: 'Sam', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '07:00', stage: 'Êñ∞ÈÉéÊ∫ñÂÇô', description: 'SamÂà∞ÈªÉÂüîÂåñÂ¶ùËëóË§Ç', responsible: 'Sam', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '07:00', stage: 'Êñ∞Â®òÊ∫ñÂÇô', description: 'ÂÆ∂ÂßêÂà∞ÈÖíÂ∫ó', responsible: 'ÂÆ∂Âßê', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '07:15', stage: 'Êñ∞ÈÉéÊñπ', description: 'ÂÖÑÂºüËëóË°´,ÈªÉÂüîÊó©È§ê', responsible: 'Ivan', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '07:45', stage: 'Êñ∞ÈÉéÊ∫ñÂÇô', description: 'Êñ∞ÈÉéready', responsible: 'Sam', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '07:45', stage: 'Êñ∞Â®òÊñπ', description: 'Áà∏Áà∏Êé•Â©ÜÂ©ÜÂà∞ÈÖíÂ∫ó', responsible: 'Áà∏Áà∏', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '08:00', stage: '‰ΩàÁΩÆÊ∫ñÂÇô', description: 'ËÅØÁµ°Ëä±Ëªä„ÄÅ28Â∫ß(Á¢∫Ë™çÊôÇÈñì)', responsible: 'Sam', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '08:00', stage: '‰ΩàÁΩÆÊ∫ñÂÇô', description: '‰ΩàÁΩÆËä±Ëªä(Â§ñÈù¢È¶¨Ë∑ØÈÇä)', responsible: 'Ivan', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '08:00', stage: '‰ΩàÁΩÆÊ∫ñÂÇô', description: 'ÊîùÂΩ±Â∏´Êñ∞Â®òÊàøÈõÜÂêà', responsible: 'ÊîùÂΩ±Â∏´', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '08:00', stage: 'ÂçîË™ø', description: 'Á¢∫Ë™çË¶™ÊàöÂà∞ÈΩä„ÄÅÂåñÂ¶ùÂÆåÊàê', responsible: 'Êú±Áèä', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '08:00', stage: 'Â§ñÊôØ', description: 'ÂÖÑÂºüÂΩ±Â§ñÊôØ(ÈªÉÂüîÊµ∑ÊóÅ)', responsible: 'Ivan', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '08:45', stage: 'Êñ∞ÈÉéÂÆ∂Ê∫ñÂÇô', description: 'Áî∑ÂÆ∂Â∫∑ÂüéÈõÜÂêà', responsible: 'Kevin', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '08:55', stage: 'ÈñãÈñÄÂÑÄÂºè', description: 'Ê∫ñÂÇôÁâ©Ë≥á(Á¥∞Êàø)', responsible: 'Sam', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '09:00', stage: 'ÈñãÈñÄÂÑÄÂºè', description: 'ÈñãÈñÄ', responsible: 'Ëá™ÊÅ©', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '09:00', stage: 'ÈñãÈñÄÂÑÄÂºè', description: 'Áé©ÂÖÑÂºü„ÄÅÊé•Êñ∞Â®ò', responsible: 'Êñ∞ÈÉéÊñπ', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '09:00', stage: 'Êñ∞ÈÉéÂÆ∂Ê∫ñÂÇô', description: 'ÂæêÂ™ΩÂ™Ω+ÂßêÂßêÂåñÂ¶ù', responsible: 'ÂåñÂ¶ùÂ∏´', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '09:20', stage: 'ÈñãÈñÄÂÑÄÂºè', description: 'ÊÑõÁöÑÂÆ£Ë®Ä', responsible: 'Êñ∞ÈÉéÊñ∞Â®ò', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '09:25', stage: 'ÈñãÈñÄÂÑÄÂºè', description: 'Â™ΩÂí™ÊÑüË®Ä', responsible: 'Â™ΩÂ™ΩÂÄë', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '09:30', stage: 'Êï¨Ëå∂ÂÑÄÂºè', description: 'Êï¨Ëå∂(Êñ∞Â®òÊñπ)', responsible: 'Êú±Áèä„ÄÅÊ¢ÖÂØ∂„ÄÅÈ´òling„ÄÅÁúüc„ÄÅGloria', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '09:50', stage: 'Êï¨Ëå∂ÂÑÄÂºè', description: 'Êï¨Ëå∂ÂÆåÊàê', responsible: 'ÂçîË™øËÄÖ', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '09:55', stage: 'Âá∫ÈñÄÊ∫ñÂÇô', description: 'ÈñãÂßãÊî∂Êãæ„ÄÅfinal checkÈÖíÂ∫ó', responsible: 'Ëá™ÊÅ©„ÄÅCarol', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '09:55', stage: 'Âá∫ÈñÄÊ∫ñÂÇô', description: 'ËÅØÁµ°Ëä±Ëªä28Â∫ß', responsible: 'Ëá™ÊÅ©', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '10:00', stage: 'Âá∫ÈñÄÊ∫ñÂÇô', description: 'Ëä±Ëªä„ÄÅ28Â∫ßÂà∞ÈÅî', responsible: 'Âè∏Ê©üÂÄë', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '10:10', stage: 'Âá∫ÈñÄ', description: 'Êñ∞‰∫∫Âá∫ÈñÄÊãéÁ¥ÖÂÇò', responsible: 'Êñ∞ÈÉéÊñ∞Â®ò', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '10:15', stage: 'Âá∫ÈñÄ', description: 'Êñ∞‰∫∫Ëä±Ëªä„ÄÅ28Â∫ßÈªÉÂüîÂá∫Áôº', responsible: 'Âè∏Ê©ü', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '10:30', stage: 'Êñ∞ÈÉéÂÆ∂Ê∫ñÂÇô', description: 'Áî∑ÂÆ∂ÂÆ∂‰∫∫Âà∞ÈΩä„ÄÅÂåñÂ¶ùÂÆåÊàê', responsible: 'Kevin', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '10:45', stage: 'ÂÖ•ÈñÄÂÑÄÂºè', description: 'Êñ∞‰∫∫Âà∞Áî∑ÂÆ∂', responsible: 'Ivan„ÄÅÊú±Áèä„ÄÅÊ¢ÖÂØ∂', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '10:55', stage: 'Êï¨Ëå∂ÂÑÄÂºè', description: 'Êï¨Ëå∂(Êñ∞ÈÉéÊñπ)', responsible: 'Ivan„ÄÅÊú±Áèä„ÄÅÊ¢ÖÂØ∂', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '11:15', stage: 'Âá∫ÈñÄÊ∫ñÂÇô', description: 'Êï¨Ëå∂ÂÆåÊàê„ÄÅÁ∞°ÂñÆÊî∂Êãæ', responsible: 'Ëá™ÊÅ©„ÄÅIvan', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '11:25', stage: 'Âá∫ÈñÄ', description: 'Âá∫ÈñÄ', responsible: 'ÂçîË™øËÄÖ', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '11:30', stage: 'Âá∫ÈñÄ', description: 'Êñ∞‰∫∫Ëä±Ëªä28Â∫ßÂ∫∑ÂüéÂá∫Áôº', responsible: 'Âè∏Ê©ü', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '11:50', stage: 'ÊïôÂ†ÇÊ∫ñÂÇô', description: 'Êñ∞‰∫∫Âà∞ÊïôÂ†Ç„ÄÅÊñ∞ÈÉéÊèõË°´', responsible: 'Sam', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '12:00', stage: 'ÊïôÂ†ÇÊ∫ñÂÇô', description: 'ÂÖÑÂºüÂßäÂ¶π„ÄÅË¶™ÂèãÈ£üÈ£Ø(1Â∞èÊôÇ)', responsible: 'Kevin„ÄÅIvan', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '12:00', stage: 'ÊïôÂ†ÇÊ∫ñÂÇô', description: 'Ëä±‰ΩàÁΩÆÈöä(Rex team)Âà∞ÈÅîÊïôÂ†Ç', responsible: 'Sam„ÄÅRex', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '12:30', stage: 'ÊïôÂ†ÇÊ∫ñÂÇô', description: '‰ΩàÁΩÆÈöä(Angel team)Âà∞ÈÅîÊïôÂ†Ç', responsible: 'Angel', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '12:40', stage: 'ÊïôÂ†ÇÊ∫ñÂÇô', description: 'ËàûËπàÈöärehearsal', responsible: 'Ps. Lily', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '12:50', stage: 'ÊïôÂ†ÇÊ∫ñÂÇô', description: 'Êñ∞‰∫∫‰º¥Â®òÂø´È£ü', responsible: 'Sam„ÄÅNam„ÄÅÊú±Áèä', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '13:00', stage: 'ÊïôÂ†ÇÊ∫ñÂÇô', description: 'Êï¨ÊãúÈöä„ÄÅËàûËπàÈöärehearsal', responsible: 'Ps. Lily', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '13:15', stage: 'ÊïôÂ†ÇÊ∫ñÂÇô', description: 'ÂÖÑÂºüÂßäÂ¶πËøîÂà∞ÊïôÂ†Ç', responsible: 'Ivan', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '13:25', stage: 'ÊïôÂ†ÇÊ∫ñÂÇô', description: 'Ë©©Áè≠rehearsal', responsible: 'Ps. Lily', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '13:30', stage: 'ÊïôÂ†ÇÊ∫ñÂÇô', description: '‰∏ªÁ¶Æ‰∫∫„ÄÅÊñ∞‰∫∫„ÄÅÁà∂ÊØç„ÄÅËä±‰ªîËä±Â•≥ÈõÜÂêà', responsible: 'Sam', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '13:40', stage: 'ÊïôÂ†ÇÊ∫ñÂÇô', description: 'Ëä±‰ªîËä±Â•≥Rehearsal', responsible: 'ÂçîË™øËÄÖ', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '14:00', stage: 'Ë®ºÂ©ö', description: 'ÈñãÂßãË°åÁ¶Æ', responsible: 'Samuel', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '16:00', stage: 'Ë®ºÂ©ö', description: 'Á¶ÆÊàê(ÊãçÁÖßÂàÜ‰∫´)', responsible: 'Samuel', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '17:00', stage: 'ÊôöÂÆ¥', description: 'Êñ∞ÈÉéÊñ∞Â®òÊèõÊôöË£ù', responsible: 'Sam„ÄÅNam', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '17:00', stage: 'ÊôöÂÆ¥', description: '‰ΩàÁΩÆÈöäÈñãÂßãsetup', responsible: 'Angel„ÄÅIvan', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '17:30', stage: 'ÊôöÂÆ¥', description: 'ËøéË≥ì+ÂçîË™ø', responsible: 'Sam„ÄÅKevin', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '18:00', stage: 'ÊôöÂÆ¥', description: 'ÂêåÈÖíÊ®ìfinal rehearsal', responsible: 'Sam„ÄÅSamuel„ÄÅIvan', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '18:15', stage: 'ÊôöÂÆ¥', description: 'ÂàáËõãÁ≥ï', responsible: 'Ivan', status: 'Êú™ÈñãÂßã', reminder: 0 },
        { time: '20:00', stage: 'ÊôöÂÆ¥', description: 'ÊôöÂÆ¥ÂÆå', responsible: 'ÂçîË™øËÄÖ', status: 'Êú™ÈñãÂßã', reminder: 0 },
      ];

      // LocalStorage keys
      const STORAGE_KEYS = {
        TASKS: 'wedding_tasks',
        VIEW: 'wedding_view',
        SEARCH: 'wedding_search',
      };

      // Load data from localStorage
      function loadFromStorage() {
        try {
          const savedTasks = localStorage.getItem(STORAGE_KEYS.TASKS);
          const savedView = localStorage.getItem(STORAGE_KEYS.VIEW);
          const savedSearch = localStorage.getItem(STORAGE_KEYS.SEARCH);

          return {
            tasks: savedTasks ? JSON.parse(savedTasks) : [...tasksData],
            view: savedView || 'stage',
            search: savedSearch || '',
          };
        } catch (e) {
          console.error('Error loading from storage:', e);
          return {
            tasks: [...tasksData],
            view: 'stage',
            search: '',
          };
        }
      }

      // Save data to localStorage
      function saveToStorage() {
        try {
          localStorage.setItem(STORAGE_KEYS.TASKS, JSON.stringify(tasks));
          localStorage.setItem(STORAGE_KEYS.VIEW, currentView);
          localStorage.setItem(STORAGE_KEYS.SEARCH, searchQuery);
        } catch (e) {
          console.error('Error saving to storage:', e);
        }
      }

      // Initialize application state from storage
      const savedData = loadFromStorage();
      let tasks = savedData.tasks;
      let currentView = savedData.view;
      let searchQuery = savedData.search;

      // Ensure all tasks have reminder field
      tasks = tasks.map((task) => ({
        ...task,
        reminder: task.reminder !== undefined ? task.reminder : 0,
      }));

      // Status cycle
      const statusCycle = ['Êú™ÈñãÂßã', 'ÈÄ≤Ë°å‰∏≠', 'ÂÆåÊàê'];
      const statusClasses = {
        Êú™ÈñãÂßã: 'not-started',
        ÈÄ≤Ë°å‰∏≠: 'in-progress',
        ÂÆåÊàê: 'completed',
      };

      // Reminder management
      let currentReminderTaskIndex = null;
      let notifiedTasks = new Set();
      let reminderCheckInterval = null;

      // Initialize app
      function init() {
        setupEventListeners();
        restoreViewState();
        updateStats();
        renderTasks();
        requestNotificationPermission();
        startReminderCheck();
      }

      // Request notification permission
      async function requestNotificationPermission() {
        if ('Notification' in window && Notification.permission === 'default') {
          try {
            await Notification.requestPermission();
          } catch (e) {
            console.error('Error requesting notification permission:', e);
          }
        }
      }

      // Open reminder modal
      function openReminderModal(taskIndex, event) {
        if (event) {
          event.stopPropagation();
        }

        const task = tasks[taskIndex];
        currentReminderTaskIndex = taskIndex;

        document.getElementById('modalTaskTime').textContent = task.time;
        document.getElementById('modalTaskDesc').textContent = task.description;

        // Show notification warning if permission not granted
        const notificationWarning = document.getElementById('notificationWarning');
        if ('Notification' in window && Notification.permission !== 'granted') {
          notificationWarning.style.display = 'block';
        } else {
          notificationWarning.style.display = 'none';
        }

        // Set current reminder value
        const reminderValue = task.reminder || 0;
        document.querySelectorAll('input[name="reminder"]').forEach((radio) => {
          radio.checked = parseInt(radio.value) === reminderValue;
        });

        // Update selected class
        document.querySelectorAll('.reminder-option').forEach((option) => {
          const value = parseInt(option.dataset.value);
          if (value === reminderValue) {
            option.classList.add('selected');
          } else {
            option.classList.remove('selected');
          }
        });

        document.getElementById('reminderModal').classList.add('active');
      }

      // Close reminder modal
      function closeReminderModal() {
        document.getElementById('reminderModal').classList.remove('active');
        currentReminderTaskIndex = null;
      }

      // Save reminder
      function saveReminder() {
        if (currentReminderTaskIndex === null) return;

        const selectedRadio = document.querySelector('input[name="reminder"]:checked');
        const reminderValue = selectedRadio ? parseInt(selectedRadio.value) : 0;

        const task = tasks[currentReminderTaskIndex];
        const oldReminder = task.reminder;

        // Clear old notification flag if reminder changed
        if (oldReminder !== reminderValue) {
          const oldNotificationKey = `${currentReminderTaskIndex}-${task.time}-${oldReminder}`;
          notifiedTasks.delete(oldNotificationKey);
        }

        task.reminder = reminderValue;
        saveToStorage();
        renderTasks();
        closeReminderModal();

        // Request permission if not granted
        if (reminderValue > 0 && 'Notification' in window && Notification.permission === 'default') {
          Notification.requestPermission();
        }
      }

      // Cleanup on page unload
      window.addEventListener('beforeunload', () => {
        if (reminderCheckInterval) {
          clearInterval(reminderCheckInterval);
        }
      });

      // Restore view state
      function restoreViewState() {
        // Restore active tab
        document.querySelectorAll('.tab-button').forEach((button) => {
          if (button.dataset.view === currentView) {
            button.classList.add('active');
          } else {
            button.classList.remove('active');
          }
        });

        // Restore search input
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
          searchInput.value = searchQuery;
        }
      }

      // Setup event listeners
      function setupEventListeners() {
        // View tabs
        document.querySelectorAll('.tab-button').forEach((button) => {
          button.addEventListener('click', (e) => {
            document.querySelectorAll('.tab-button').forEach((b) => b.classList.remove('active'));
            e.target.classList.add('active');
            currentView = e.target.dataset.view;
            saveToStorage();
            renderTasks();
          });
        });

        // Search
        document.getElementById('searchInput').addEventListener('input', (e) => {
          searchQuery = e.target.value.toLowerCase();
          saveToStorage();
          renderTasks();
        });

        // Modal reminder options
        document.querySelectorAll('.reminder-option').forEach((option) => {
          option.addEventListener('click', function () {
            const radio = this.querySelector('input[type="radio"]');
            radio.checked = true;

            document.querySelectorAll('.reminder-option').forEach((opt) => {
              opt.classList.remove('selected');
            });
            this.classList.add('selected');
          });
        });

        // Close modal on overlay click
        document.getElementById('reminderModal').addEventListener('click', function (e) {
          if (e.target === this) {
            closeReminderModal();
          }
        });
      }

      // Start reminder check
      function startReminderCheck() {
        // Check every 30 seconds
        reminderCheckInterval = setInterval(checkReminders, 30000);
        // Also check immediately
        checkReminders();
      }

      // Check for reminders
      function checkReminders() {
        if ('Notification' in window && Notification.permission !== 'granted') {
          return;
        }

        const now = new Date();
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        const currentTimeInMinutes = currentHour * 60 + currentMinute;

        tasks.forEach((task, index) => {
          // Skip if no reminder set or task is completed
          if (!task.reminder || task.reminder === 0 || task.status === 'ÂÆåÊàê') {
            return;
          }

          // Skip if already notified
          const notificationKey = `${index}-${task.time}-${task.reminder}`;
          if (notifiedTasks.has(notificationKey)) {
            return;
          }

          const [taskHour, taskMinute] = task.time.split(':').map(Number);
          const taskTimeInMinutes = taskHour * 60 + taskMinute;
          const reminderTimeInMinutes = taskTimeInMinutes - task.reminder;

          // Check if it's time to notify (within 1 minute window)
          if (currentTimeInMinutes >= reminderTimeInMinutes && currentTimeInMinutes < reminderTimeInMinutes + 1) {
            sendNotification(task, index);
            notifiedTasks.add(notificationKey);
          }
        });
      }

      // Send notification
      function sendNotification(task, index) {
        if ('Notification' in window && Notification.permission === 'granted') {
          const notification = new Notification('Â©öÁ¶Æ‰ªªÂãôÊèêÈÜí ‚è∞', {
            body: `${task.time} - ${task.description}\nË≤†Ë≤¨‰∫∫: ${task.responsible}`,
            icon: 'üîî',
            tag: `task-${index}`,
            requireInteraction: true,
          });

          notification.onclick = function () {
            window.focus();
            notification.close();
          };
        }
      }

      // Toggle task status
      function toggleTaskStatus(index) {
        const task = tasks[index];
        const currentStatusIndex = statusCycle.indexOf(task.status);
        const nextStatusIndex = (currentStatusIndex + 1) % statusCycle.length;
        task.status = statusCycle[nextStatusIndex];

        // Clear notification flag when status changes
        if (task.status === 'ÂÆåÊàê') {
          const notificationKey = `${index}-${task.time}-${task.reminder}`;
          notifiedTasks.delete(notificationKey);
        }

        saveToStorage();
        updateStats();
        renderTasks();
      }

      // Get task time status
      function getTaskTimeStatus(taskTime) {
        const now = new Date();
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        const currentTimeInMinutes = currentHour * 60 + currentMinute;

        const [taskHour, taskMinute] = taskTime.split(':').map(Number);
        const taskTimeInMinutes = taskHour * 60 + taskMinute;

        const diffInMinutes = taskTimeInMinutes - currentTimeInMinutes;

        if (diffInMinutes < 0) {
          return 'overdue';
        } else if (diffInMinutes <= 30) {
          return 'upcoming';
        }
        return 'normal';
      }

      // Filter tasks by search
      function filterTasks() {
        if (!searchQuery) return tasks;

        return tasks.filter((task) => {
          return (
            task.description.toLowerCase().includes(searchQuery) ||
            task.responsible.toLowerCase().includes(searchQuery) ||
            task.stage.toLowerCase().includes(searchQuery)
          );
        });
      }

      // Update statistics
      function updateStats() {
        const completed = tasks.filter((t) => t.status === 'ÂÆåÊàê').length;
        const inProgress = tasks.filter((t) => t.status === 'ÈÄ≤Ë°å‰∏≠').length;
        const notStarted = tasks.filter((t) => t.status === 'Êú™ÈñãÂßã').length;
        const percentage = Math.round((completed / tasks.length) * 100);

        document.getElementById('completedCount').textContent = completed;
        document.getElementById('inProgressCount').textContent = inProgress;
        document.getElementById('notStartedCount').textContent = notStarted;
        document.getElementById('progressPercentage').textContent = percentage + '%';
      }

      // Render tasks
      function renderTasks() {
        const container = document.getElementById('tasksContainer');
        const statsSection = document.getElementById('statsSection');
        const filteredTasks = filterTasks();

        if (currentView === 'stats') {
          statsSection.style.display = 'grid';
          container.innerHTML = '';
          return;
        } else {
          statsSection.style.display = 'none';
        }

        if (filteredTasks.length === 0) {
          container.innerHTML = '<div class="no-results">Ê≤íÊúâÊâæÂà∞Á¨¶ÂêàÁöÑ‰ªªÂãô</div>';
          return;
        }

        let groupedTasks = {};

        if (currentView === 'timeline') {
          // Group by time (chronological)
          groupedTasks = { ÊâÄÊúâ‰ªªÂãô: filteredTasks.sort((a, b) => a.time.localeCompare(b.time)) };
        } else if (currentView === 'stage') {
          // Group by stage
          filteredTasks.forEach((task) => {
            if (!groupedTasks[task.stage]) {
              groupedTasks[task.stage] = [];
            }
            groupedTasks[task.stage].push(task);
          });
        } else if (currentView === 'responsible') {
          // Group by responsible person
          filteredTasks.forEach((task) => {
            if (!groupedTasks[task.responsible]) {
              groupedTasks[task.responsible] = [];
            }
            groupedTasks[task.responsible].push(task);
          });
        }

        let html = '';

        Object.keys(groupedTasks).forEach((groupName) => {
          const groupTasks = groupedTasks[groupName];
          html += `
          <div class="group-section">
            <div class="group-header">
              <span>${groupName}</span>
              <span class="group-count">${groupTasks.length} ÂÄã‰ªªÂãô</span>
            </div>
        `;

          groupTasks.forEach((task, idx) => {
            const originalIndex = tasks.indexOf(task);
            const timeStatus = getTaskTimeStatus(task.time);
            const statusClass = statusClasses[task.status];
            const timeClass = task.status !== 'ÂÆåÊàê' ? timeStatus : '';

            // Reminder badge
            let reminderBadge = '';
            if (task.reminder && task.reminder > 0) {
              reminderBadge = `
                <div class="reminder-badge" onclick="openReminderModal(${originalIndex}, event)">
                  <span class="reminder-icon">‚è∞</span>
                  <span>ÊèêÂâç ${task.reminder} ÂàÜÈêò</span>
                </div>
              `;
            } else {
              reminderBadge = `
                <div class="reminder-badge" onclick="openReminderModal(${originalIndex}, event)" style="opacity: 0.5;">
                  <span class="reminder-icon">üîî</span>
                  <span>Ë®≠ÁΩÆÊèêÈÜí</span>
                </div>
              `;
            }

            html += `
            <div class="task-item ${statusClass} ${timeClass}" onclick="toggleTaskStatus(${originalIndex})">
              <div class="task-time">${task.time}</div>
              <div class="task-content">
                <div class="task-description">${task.description}</div>
                <div class="task-stage">${task.stage}</div>
                ${reminderBadge}
              </div>
              <div class="task-responsible">${task.responsible}</div>
              <div class="task-status ${statusClass}">${task.status}</div>
            </div>
          `;
          });

          html += '</div>';
        });

        container.innerHTML = html;
      }

      // Initialize the application
      init();
    </script>
  </body>
</html>
